# In wrangler.toml

# A user-friendly name for the Worker service.
name = "storybook-deployment-service"

# The entry point file for the Worker.
main = "src/entry.worker.ts"

# Specifies the version of the Workers runtime APIs to use.
compatibility_date = "2024-03-01"

# Defines the bindings to other Cloudflare resources.
[[r2_buckets]]
# The variable name used to access the binding in the code (c.env.STORYBOOK_BUCKET).
binding = "STORYBOOK_BUCKET"
# The name of the actual R2 bucket in the Cloudflare dashboard.
bucket_name = "my-storybooks-production"
# For local development, a preview bucket can be specified.
preview_bucket_name = "my-storybooks-staging"

# --- Environment Variables and Secrets ---
# The following variables are required for the S3-compatible API to work.
# For local development with `wrangler dev`, you can define them in this `.dev.vars` file.
# For production, you must set these as secrets using the `wrangler secret put` command.
# Example: `wrangler secret put R2_ACCOUNT_ID`

[vars]
# These are placeholders for production. Actual values are set via:
# - .dev.vars file for local development (wrangler dev)
# - wrangler secret put commands for production deployment
R2_ACCOUNT_ID = "f54b9c10de9d140756dbf449aa124f1e"
R2_BUCKET_NAME = "my-storybooks-production"
# Note: Sensitive credentials should NOT be stored in this file.
# Set these via .dev.vars for local development:
R2_S3_ACCESS_KEY_ID = "placeholder-set-via-dev-vars-or-secrets"
R2_S3_SECRET_ACCESS_KEY = "placeholder-set-via-dev-vars-or-secrets"

# Preview environment for PR deployments
[env.preview]
name = "storybook-deployment-service-preview"
vars = { R2_BUCKET_NAME = "my-storybooks-staging" }

[[env.preview.r2_buckets]]
binding = "STORYBOOK_BUCKET"
bucket_name = "my-storybooks-staging"
preview_bucket_name = "my-storybooks-staging"
